{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\nexports.reset = exports.auth = exports.ui = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nexports.setup = setup;\nexports.id = id;\nexports.clientID = clientID;\nexports.domain = domain;\nexports.clientBaseUrl = clientBaseUrl;\nexports.tenantBaseUrl = tenantBaseUrl;\nexports.useTenantInfo = useTenantInfo;\nexports.connectionResolver = connectionResolver;\nexports.setResolvedConnection = setResolvedConnection;\nexports.resolvedConnection = resolvedConnection;\nexports.languageBaseUrl = languageBaseUrl;\nexports.setSubmitting = setSubmitting;\nexports.submitting = submitting;\nexports.setGlobalError = setGlobalError;\nexports.globalError = globalError;\nexports.clearGlobalError = clearGlobalError;\nexports.setGlobalSuccess = setGlobalSuccess;\nexports.globalSuccess = globalSuccess;\nexports.clearGlobalSuccess = clearGlobalSuccess;\nexports.setGlobalInfo = setGlobalInfo;\nexports.globalInfo = globalInfo;\nexports.clearGlobalInfo = clearGlobalInfo;\nexports.rendering = rendering;\nexports.stopRendering = stopRendering;\nexports.withAuthOptions = withAuthOptions;\nexports.extractTenantBaseUrlOption = extractTenantBaseUrlOption;\nexports.render = render;\nexports.setLoggedIn = setLoggedIn;\nexports.loggedIn = loggedIn;\nexports.defaultADUsernameFromEmailPrefix = defaultADUsernameFromEmailPrefix;\nexports.prefill = prefill;\nexports.warn = warn;\nexports.error = error;\nexports.allowedConnections = allowedConnections;\nexports.connections = connections;\nexports.connection = connection;\nexports.hasOneConnection = hasOneConnection;\nexports.hasOnlyConnections = hasOnlyConnections;\nexports.hasSomeConnections = hasSomeConnections;\nexports.countConnections = countConnections;\nexports.findConnection = findConnection;\nexports.hasConnection = hasConnection;\nexports.filterConnections = filterConnections;\nexports.runHook = runHook;\nexports.emitEvent = emitEvent;\nexports.loginErrorMessage = loginErrorMessage;\nexports.stop = stop;\nexports.hasStopped = hasStopped;\nexports.hashCleanup = hashCleanup;\nexports.emitHashParsedEvent = emitHashParsedEvent;\nexports.emitAuthenticatedEvent = emitAuthenticatedEvent;\nexports.emitAuthorizationErrorEvent = emitAuthorizationErrorEvent;\nexports.emitUnrecoverableErrorEvent = emitUnrecoverableErrorEvent;\nexports.showBadge = showBadge;\nexports.overrideOptions = overrideOptions;\n\nvar _urlJoin = require('url-join');\n\nvar _urlJoin2 = _interopRequireDefault(_urlJoin);\n\nvar _immutable = require('immutable');\n\nvar _immutable2 = _interopRequireDefault(_immutable);\n\nvar _media_utils = require('../utils/media_utils');\n\nvar _string_utils = require('../utils/string_utils');\n\nvar _url_utils = require('../utils/url_utils');\n\nvar _i18n = require('../i18n');\n\nvar i18n = _interopRequireWildcard(_i18n);\n\nvar _trim = require('trim');\n\nvar _trim2 = _interopRequireDefault(_trim);\n\nvar _gravatar_provider = require('../avatar/gravatar_provider');\n\nvar gp = _interopRequireWildcard(_gravatar_provider);\n\nvar _data_utils = require('../utils/data_utils');\n\nvar _index = require('../connection/social/index');\n\nvar _index2 = require('./client/index');\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar _dataFns = (0, _data_utils.dataFns)(['core']),\n    get = _dataFns.get,\n    init = _dataFns.init,\n    remove = _dataFns.remove,\n    reset = _dataFns.reset,\n    set = _dataFns.set,\n    tget = _dataFns.tget,\n    tset = _dataFns.tset,\n    tremove = _dataFns.tremove;\n\nvar _dataFns2 = (0, _data_utils.dataFns)(['social']),\n    tsetSocial = _dataFns2.tset;\n\nfunction setup(id, clientID, domain, options, hookRunner, emitEventFn) {\n  var m = init(id, _immutable2.default.fromJS({\n    clientBaseUrl: extractClientBaseUrlOption(options, domain),\n    tenantBaseUrl: extractTenantBaseUrlOption(options, domain),\n    languageBaseUrl: extractLanguageBaseUrlOption(options, domain),\n    auth: extractAuthOptions(options),\n    clientID: clientID,\n    domain: domain,\n    emitEventFn: emitEventFn,\n    hookRunner: hookRunner,\n    useTenantInfo: options.__useTenantInfo || false,\n    hashCleanup: options.hashCleanup === false ? false : true,\n    allowedConnections: _immutable2.default.fromJS(options.allowedConnections || []),\n    ui: extractUIOptions(id, options),\n    defaultADUsernameFromEmailPrefix: options.defaultADUsernameFromEmailPrefix === false ? false : true,\n    prefill: options.prefill || {},\n    connectionResolver: options.connectionResolver\n  }));\n  m = i18n.initI18n(m);\n  return m;\n}\n\nfunction id(m) {\n  return m.get('id');\n}\n\nfunction clientID(m) {\n  return get(m, 'clientID');\n}\n\nfunction domain(m) {\n  return get(m, 'domain');\n}\n\nfunction clientBaseUrl(m) {\n  return get(m, 'clientBaseUrl');\n}\n\nfunction tenantBaseUrl(m) {\n  return get(m, 'tenantBaseUrl');\n}\n\nfunction useTenantInfo(m) {\n  return get(m, 'useTenantInfo');\n}\n\nfunction connectionResolver(m) {\n  return get(m, 'connectionResolver');\n}\n\nfunction setResolvedConnection(m, resolvedConnection) {\n  if (!resolvedConnection) {\n    return set(m, 'resolvedConnection', undefined);\n  }\n\n  if (!resolvedConnection.type || !resolvedConnection.name) {\n    throw new Error('Invalid connection object. The resolved connection must look like: `{ type: \"database\", name: \"connection name\" }`.');\n  }\n\n  if (resolvedConnection.type !== 'database') {\n    throw new Error('Invalid connection type. Only database connections can be resolved with a custom resolver.');\n  }\n\n  return set(m, 'resolvedConnection', _immutable2.default.fromJS(resolvedConnection));\n}\n\nfunction resolvedConnection(m) {\n  var resolvedConnection = get(m, 'resolvedConnection');\n\n  if (!resolvedConnection) {\n    return undefined;\n  }\n\n  return findConnection(m, resolvedConnection.get('name'));\n}\n\nfunction languageBaseUrl(m) {\n  return get(m, 'languageBaseUrl');\n}\n\nfunction setSubmitting(m, value) {\n  var error = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n  m = tset(m, 'submitting', value);\n  m = clearGlobalSuccess(m);\n  m = error && !value ? setGlobalError(m, error) : clearGlobalError(m);\n  return m;\n}\n\nfunction submitting(m) {\n  return tget(m, 'submitting', false);\n}\n\nfunction setGlobalError(m, str) {\n  return tset(m, 'globalError', str);\n}\n\nfunction globalError(m) {\n  return tget(m, 'globalError', '');\n}\n\nfunction clearGlobalError(m) {\n  return tremove(m, 'globalError');\n}\n\nfunction setGlobalSuccess(m, str) {\n  return tset(m, 'globalSuccess', str);\n}\n\nfunction globalSuccess(m) {\n  return tget(m, 'globalSuccess', '');\n}\n\nfunction clearGlobalSuccess(m) {\n  return tremove(m, 'globalSuccess');\n}\n\nfunction setGlobalInfo(m, str) {\n  return tset(m, 'globalInfo', str);\n}\n\nfunction globalInfo(m) {\n  return tget(m, 'globalInfo', '');\n}\n\nfunction clearGlobalInfo(m) {\n  return tremove(m, 'globalInfo');\n}\n\nfunction rendering(m) {\n  return tget(m, 'render', false);\n}\n\nfunction stopRendering(m) {\n  return tremove(m, 'render');\n}\n\nfunction extractUIOptions(id, options) {\n  var closable = options.container ? false : undefined === options.closable ? true : !!options.closable;\n  var theme = options.theme || {};\n  var labeledSubmitButton = theme.labeledSubmitButton,\n      hideMainScreenTitle = theme.hideMainScreenTitle,\n      logo = theme.logo,\n      primaryColor = theme.primaryColor,\n      authButtons = theme.authButtons;\n  var avatar = options.avatar !== null;\n  var customAvatarProvider = options.avatar && typeof options.avatar.url === 'function' && typeof options.avatar.displayName === 'function' && options.avatar;\n  var avatarProvider = customAvatarProvider || gp;\n  return new _immutable2.default.fromJS({\n    containerID: options.container || 'auth0-lock-container-' + id,\n    appendContainer: !options.container,\n    autoclose: undefined === options.autoclose ? false : closable && options.autoclose,\n    autofocus: undefined === options.autofocus ? !(options.container || (0, _media_utils.isSmallScreen)()) : !!options.autofocus,\n    avatar: avatar,\n    avatarProvider: avatarProvider,\n    logo: typeof logo === 'string' ? logo : undefined,\n    closable: closable,\n    hideMainScreenTitle: !!hideMainScreenTitle,\n    labeledSubmitButton: undefined === labeledSubmitButton ? true : !!labeledSubmitButton,\n    language: undefined === options.language ? 'en' : (0, _trim2.default)(options.language || '').toLowerCase(),\n    dict: _typeof(options.languageDictionary) === 'object' ? options.languageDictionary : {},\n    disableWarnings: options.disableWarnings === undefined ? false : !!options.disableWarnings,\n    mobile: undefined === options.mobile ? false : !!options.mobile,\n    popupOptions: undefined === options.popupOptions ? {} : options.popupOptions,\n    primaryColor: typeof primaryColor === 'string' ? primaryColor : undefined,\n    rememberLastLogin: undefined === options.rememberLastLogin ? true : !!options.rememberLastLogin,\n    allowAutocomplete: !!options.allowAutocomplete,\n    authButtonsTheme: (typeof authButtons === 'undefined' ? 'undefined' : _typeof(authButtons)) === 'object' ? authButtons : {},\n    allowShowPassword: !!options.allowShowPassword,\n    allowPasswordAutocomplete: !!options.allowPasswordAutocomplete,\n    scrollGlobalMessagesIntoView: undefined === options.scrollGlobalMessagesIntoView ? true : !!options.scrollGlobalMessagesIntoView\n  });\n}\n\nvar _dataFns3 = (0, _data_utils.dataFns)(['core', 'ui']),\n    getUI = _dataFns3.get,\n    setUI = _dataFns3.set;\n\nvar _dataFns4 = (0, _data_utils.dataFns)(['core', 'transient', 'ui']),\n    tgetUI = _dataFns4.get,\n    tsetUI = _dataFns4.set;\n\nvar getUIAttribute = function getUIAttribute(m, attribute) {\n  return tgetUI(m, attribute) || getUI(m, attribute);\n};\n\nvar ui = exports.ui = {\n  containerID: function containerID(lock) {\n    return getUIAttribute(lock, 'containerID');\n  },\n  appendContainer: function appendContainer(lock) {\n    return getUIAttribute(lock, 'appendContainer');\n  },\n  autoclose: function autoclose(lock) {\n    return getUIAttribute(lock, 'autoclose');\n  },\n  autofocus: function autofocus(lock) {\n    return getUIAttribute(lock, 'autofocus');\n  },\n  avatar: function avatar(lock) {\n    return getUIAttribute(lock, 'avatar');\n  },\n  avatarProvider: function avatarProvider(lock) {\n    return getUIAttribute(lock, 'avatarProvider');\n  },\n  closable: function closable(lock) {\n    return getUIAttribute(lock, 'closable');\n  },\n  dict: function dict(lock) {\n    return getUIAttribute(lock, 'dict');\n  },\n  disableWarnings: function disableWarnings(lock) {\n    return getUIAttribute(lock, 'disableWarnings');\n  },\n  labeledSubmitButton: function labeledSubmitButton(lock) {\n    return getUIAttribute(lock, 'labeledSubmitButton');\n  },\n  hideMainScreenTitle: function hideMainScreenTitle(lock) {\n    return getUIAttribute(lock, 'hideMainScreenTitle');\n  },\n  language: function language(lock) {\n    return getUIAttribute(lock, 'language');\n  },\n  logo: function logo(lock) {\n    return getUIAttribute(lock, 'logo');\n  },\n  mobile: function mobile(lock) {\n    return getUIAttribute(lock, 'mobile');\n  },\n  popupOptions: function popupOptions(lock) {\n    return getUIAttribute(lock, 'popupOptions');\n  },\n  primaryColor: function primaryColor(lock) {\n    return getUIAttribute(lock, 'primaryColor');\n  },\n  authButtonsTheme: function authButtonsTheme(lock) {\n    return getUIAttribute(lock, 'authButtonsTheme');\n  },\n  rememberLastLogin: function rememberLastLogin(m) {\n    return tget(m, 'rememberLastLogin', getUIAttribute(m, 'rememberLastLogin'));\n  },\n  allowAutocomplete: function allowAutocomplete(m) {\n    return tget(m, 'allowAutocomplete', getUIAttribute(m, 'allowAutocomplete'));\n  },\n  scrollGlobalMessagesIntoView: function scrollGlobalMessagesIntoView(lock) {\n    return getUIAttribute(lock, 'scrollGlobalMessagesIntoView');\n  },\n  allowShowPassword: function allowShowPassword(m) {\n    return tget(m, 'allowShowPassword', getUIAttribute(m, 'allowShowPassword'));\n  },\n  allowPasswordAutocomplete: function allowPasswordAutocomplete(m) {\n    return tget(m, 'allowPasswordAutocomplete', getUIAttribute(m, 'allowPasswordAutocomplete'));\n  }\n};\n\nvar _dataFns5 = (0, _data_utils.dataFns)(['core', 'auth']),\n    getAuthAttribute = _dataFns5.get;\n\nvar auth = exports.auth = {\n  connectionScopes: function connectionScopes(m) {\n    return getAuthAttribute(m, 'connectionScopes');\n  },\n  params: function params(m) {\n    return tget(m, 'authParams') || getAuthAttribute(m, 'params');\n  },\n  autoParseHash: function autoParseHash(lock) {\n    return getAuthAttribute(lock, 'autoParseHash');\n  },\n  redirect: function redirect(lock) {\n    return getAuthAttribute(lock, 'redirect');\n  },\n  redirectUrl: function redirectUrl(lock) {\n    return getAuthAttribute(lock, 'redirectUrl');\n  },\n  responseType: function responseType(lock) {\n    return getAuthAttribute(lock, 'responseType');\n  },\n  sso: function sso(lock) {\n    return getAuthAttribute(lock, 'sso');\n  }\n};\n\nfunction extractAuthOptions(options) {\n  var _ref = options.auth || {},\n      audience = _ref.audience,\n      connectionScopes = _ref.connectionScopes,\n      params = _ref.params,\n      autoParseHash = _ref.autoParseHash,\n      redirect = _ref.redirect,\n      redirectUrl = _ref.redirectUrl,\n      responseMode = _ref.responseMode,\n      responseType = _ref.responseType,\n      sso = _ref.sso,\n      state = _ref.state,\n      nonce = _ref.nonce;\n\n  audience = typeof audience === 'string' ? audience : undefined;\n  connectionScopes = (typeof connectionScopes === 'undefined' ? 'undefined' : _typeof(connectionScopes)) === 'object' ? connectionScopes : {};\n  params = (typeof params === 'undefined' ? 'undefined' : _typeof(params)) === 'object' ? params : {}; // by default is null because we need to know if it was set when we curate the responseType\n\n  redirectUrl = typeof redirectUrl === 'string' && redirectUrl ? redirectUrl : null;\n  autoParseHash = typeof autoParseHash === 'boolean' ? autoParseHash : true;\n  redirect = typeof redirect === 'boolean' ? redirect : true;\n  responseMode = typeof responseMode === 'string' ? responseMode : undefined;\n  state = typeof state === 'string' ? state : undefined;\n  nonce = typeof nonce === 'string' ? nonce : undefined; // if responseType was not set and there is a redirectUrl, it defaults to code. Otherwise token.\n\n  responseType = typeof responseType === 'string' ? responseType : redirectUrl ? 'code' : 'token'; // now we set the default because we already did the validation\n\n  redirectUrl = redirectUrl || '' + (0, _url_utils.getOriginFromUrl)(window.location.href) + window.location.pathname;\n  sso = typeof sso === 'boolean' ? sso : true;\n\n  if (!params.scope) {\n    params.scope = 'openid profile email';\n  }\n\n  return _immutable2.default.fromJS({\n    audience: audience,\n    connectionScopes: connectionScopes,\n    params: params,\n    autoParseHash: autoParseHash,\n    redirect: redirect,\n    redirectUrl: redirectUrl,\n    responseMode: responseMode,\n    responseType: responseType,\n    sso: sso,\n    state: state,\n    nonce: nonce\n  });\n}\n\nfunction withAuthOptions(m, opts) {\n  return _immutable2.default.fromJS(opts).merge(get(m, 'auth')).toJS();\n}\n\nfunction extractClientBaseUrlOption(opts, domain) {\n  if (opts.clientBaseUrl && typeof opts.clientBaseUrl === 'string') {\n    return opts.clientBaseUrl;\n  }\n\n  if (opts.configurationBaseUrl && typeof opts.configurationBaseUrl === 'string') {\n    return opts.configurationBaseUrl;\n  }\n\n  if (opts.assetsUrl && typeof opts.assetsUrl === 'string') {\n    return opts.assetsUrl;\n  }\n\n  var domainUrl = 'https://' + domain;\n  var hostname = (0, _url_utils.getLocationFromUrl)(domainUrl).hostname;\n  var DOT_AUTH0_DOT_COM = '.auth0.com';\n  var AUTH0_US_CDN_URL = 'https://cdn.auth0.com';\n\n  if ((0, _string_utils.endsWith)(hostname, DOT_AUTH0_DOT_COM)) {\n    var parts = hostname.split('.');\n    return parts.length > 3 ? 'https://cdn.' + parts[parts.length - 3] + DOT_AUTH0_DOT_COM : AUTH0_US_CDN_URL;\n  } else {\n    return domainUrl;\n  }\n}\n\nfunction extractTenantBaseUrlOption(opts, domain) {\n  if (opts.configurationBaseUrl && typeof opts.configurationBaseUrl === 'string') {\n    if (opts.overrides && opts.overrides.__tenant) {\n      // When using a custom domain and a configuration URL hosted in auth0's cdn\n      return (0, _urlJoin2.default)(opts.configurationBaseUrl, 'tenants', 'v1', opts.overrides.__tenant + '.js');\n    }\n\n    return (0, _urlJoin2.default)(opts.configurationBaseUrl, 'info-v1.js');\n  }\n\n  if (opts.assetsUrl && typeof opts.assetsUrl === 'string') {\n    return opts.assetsUrl;\n  }\n\n  var domainUrl = 'https://' + domain;\n  var hostname = (0, _url_utils.getLocationFromUrl)(domainUrl).hostname;\n  var DOT_AUTH0_DOT_COM = '.auth0.com';\n  var AUTH0_US_CDN_URL = 'https://cdn.auth0.com';\n  var parts = hostname.split('.');\n  var tenant_name = parts[0];\n  var domain;\n\n  if ((0, _string_utils.endsWith)(hostname, DOT_AUTH0_DOT_COM)) {\n    domain = parts.length > 3 ? 'https://cdn.' + parts[parts.length - 3] + DOT_AUTH0_DOT_COM : AUTH0_US_CDN_URL;\n    return (0, _urlJoin2.default)(domain, 'tenants', 'v1', tenant_name + '.js');\n  } else {\n    return (0, _urlJoin2.default)(domainUrl, 'info-v1.js');\n  }\n}\n\nfunction extractLanguageBaseUrlOption(opts, domain) {\n  if (opts.languageBaseUrl && typeof opts.languageBaseUrl === 'string') {\n    return opts.languageBaseUrl;\n  }\n\n  if (opts.assetsUrl && typeof opts.assetsUrl === 'string') {\n    return opts.assetsUrl;\n  }\n\n  return 'https://cdn.auth0.com';\n}\n\nfunction render(m) {\n  return tset(m, 'render', true);\n}\n\nexports.reset = reset;\n\nfunction setLoggedIn(m, value) {\n  return tset(m, 'loggedIn', value);\n}\n\nfunction loggedIn(m) {\n  return tget(m, 'loggedIn', false);\n}\n\nfunction defaultADUsernameFromEmailPrefix(m) {\n  return get(m, 'defaultADUsernameFromEmailPrefix', true);\n}\n\nfunction prefill(m) {\n  return get(m, 'prefill', {});\n}\n\nfunction warn(x, str) {\n  var shouldOutput = _immutable.Map.isMap(x) ? !ui.disableWarnings(x) : !x.disableWarnings;\n\n  if (shouldOutput && console && console.warn) {\n    console.warn(str);\n  }\n}\n\nfunction error(x, str) {\n  var shouldOutput = _immutable.Map.isMap(x) ? !ui.disableWarnings(x) : !x.disableWarnings;\n\n  if (shouldOutput && console && console.error) {\n    console.error(str);\n  }\n}\n\nfunction allowedConnections(m) {\n  return tget(m, 'allowedConnections') || get(m, 'allowedConnections');\n}\n\nfunction connections(m) {\n  for (var _len = arguments.length, strategies = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n    strategies[_key - 2] = arguments[_key];\n  }\n\n  var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n\n  if (arguments.length === 1) {\n    return tget(m, 'connections', (0, _immutable.Map)()).filter(function (v, k) {\n      return k !== 'unknown';\n    }).valueSeq().flatten(true);\n  }\n\n  var xs = tget(m, ['connections', type], (0, _immutable.List)());\n  return strategies.length > 0 ? xs.filter(function (x) {\n    return ~strategies.indexOf(x.get('strategy'));\n  }) : xs;\n}\n\nfunction connection(m) {\n  var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n\n  for (var _len2 = arguments.length, strategies = Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n    strategies[_key2 - 2] = arguments[_key2];\n  }\n\n  return connections.apply(undefined, [m, type].concat(strategies)).get(0);\n}\n\nfunction hasOneConnection(m) {\n  var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n  var xs = connections(m);\n  return xs.count() === 1 && (!type || xs.getIn([0, 'type']) === type);\n}\n\nfunction hasOnlyConnections(m) {\n  var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n  var all = connections(m).count();\n\n  for (var _len3 = arguments.length, strategies = Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n    strategies[_key3 - 2] = arguments[_key3];\n  }\n\n  var filtered = connections.apply(undefined, [m, type].concat(strategies)).count();\n  return all > 0 && all === filtered;\n}\n\nfunction hasSomeConnections(m) {\n  var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n\n  for (var _len4 = arguments.length, strategies = Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n    strategies[_key4 - 2] = arguments[_key4];\n  }\n\n  return countConnections.apply(undefined, [m, type].concat(strategies)) > 0;\n}\n\nfunction countConnections(m) {\n  var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n\n  for (var _len5 = arguments.length, strategies = Array(_len5 > 2 ? _len5 - 2 : 0), _key5 = 2; _key5 < _len5; _key5++) {\n    strategies[_key5 - 2] = arguments[_key5];\n  }\n\n  return connections.apply(undefined, [m, type].concat(strategies)).count();\n}\n\nfunction findConnection(m, name) {\n  return connections(m).find(function (m1) {\n    return m1.get('name') === name;\n  });\n}\n\nfunction hasConnection(m, name) {\n  return !!findConnection(m, name);\n}\n\nfunction filterConnections(m) {\n  var allowed = allowedConnections(m);\n  var order = allowed.count() === 0 ? function (_) {\n    return 0;\n  } : function (c) {\n    return allowed.indexOf(c.get('name'));\n  };\n  return tset(m, 'connections', (0, _index2.clientConnections)(m).map(function (cs) {\n    return cs.filter(function (c) {\n      return order(c) >= 0;\n    }).sort(function (c1, c2) {\n      return order(c1) - order(c2);\n    });\n  }));\n}\n\nfunction runHook(m, str) {\n  for (var _len6 = arguments.length, args = Array(_len6 > 2 ? _len6 - 2 : 0), _key6 = 2; _key6 < _len6; _key6++) {\n    args[_key6 - 2] = arguments[_key6];\n  }\n\n  return get(m, 'hookRunner').apply(undefined, [str, m].concat(args));\n}\n\nfunction emitEvent(m, str) {\n  for (var _len7 = arguments.length, args = Array(_len7 > 2 ? _len7 - 2 : 0), _key7 = 2; _key7 < _len7; _key7++) {\n    args[_key7 - 2] = arguments[_key7];\n  }\n\n  setTimeout(function () {\n    var emitEventFn = get(m, 'emitEventFn');\n    var hadListener = emitEventFn.apply(undefined, [str].concat(args)); // Handle uncaught custom error\n\n    if (str === 'unrecoverable_error' && !hadListener) {\n      throw new (Function.prototype.bind.apply(Error, [null].concat(args)))();\n    }\n  }, 0);\n}\n\nfunction loginErrorMessage(m, error, type) {\n  // NOTE: previous version of lock checked for status codes and, at\n  // some point, if the status code was 401 it defaults to an\n  // \"invalid_user_password\" error (actually the\n  // \"wrongEmailPasswordErrorText\" dict entry) instead of checking\n  // explicitly. We should figure out if there was a reason for that.\n  if (error.status === 0) {\n    return i18n.html(m, ['error', 'login', 'lock.network']);\n  } // Custom rule error (except blocked_user)\n\n\n  if (error.code === 'rule_error') {\n    return error.description || i18n.html(m, ['error', 'login', 'lock.fallback']);\n  }\n\n  var INVALID_MAP = {\n    code: 'lock.invalid_code',\n    email: 'lock.invalid_email_password',\n    username: 'lock.invalid_username_password'\n  };\n  var code = error.error || error.code;\n\n  if (code === 'invalid_user_password' && INVALID_MAP[type]) {\n    code = INVALID_MAP[type];\n  }\n\n  if (code === 'a0.mfa_registration_required') {\n    code = 'lock.mfa_registration_required';\n  }\n\n  if (code === 'a0.mfa_invalid_code') {\n    code = 'lock.mfa_invalid_code';\n  }\n\n  return i18n.html(m, ['error', 'login', code]) || i18n.html(m, ['error', 'login', 'lock.fallback']);\n} // TODO: rename to something less generic that is easier to grep\n\n\nfunction stop(m, error) {\n  if (error) {\n    setTimeout(function () {\n      return emitEvent(m, 'unrecoverable_error', error);\n    }, 17);\n  }\n\n  return set(m, 'stopped', true);\n}\n\nfunction hasStopped(m) {\n  return get(m, 'stopped');\n}\n\nfunction hashCleanup(m) {\n  return get(m, 'hashCleanup');\n}\n\nfunction emitHashParsedEvent(m, parsedHash) {\n  emitEvent(m, 'hash_parsed', parsedHash);\n}\n\nfunction emitAuthenticatedEvent(m, result) {\n  emitEvent(m, 'authenticated', result);\n}\n\nfunction emitAuthorizationErrorEvent(m, error) {\n  emitEvent(m, 'authorization_error', error);\n}\n\nfunction emitUnrecoverableErrorEvent(m, error) {\n  emitEvent(m, 'unrecoverable_error', error);\n}\n\nfunction showBadge(m) {\n  return (0, _index2.hasFreeSubscription)(m) || false;\n}\n\nfunction overrideOptions(m, opts) {\n  if (!opts) opts = {};\n\n  if (opts.allowedConnections) {\n    m = tset(m, 'allowedConnections', _immutable2.default.fromJS(opts.allowedConnections));\n  }\n\n  if (opts.socialButtonStyle) {\n    var curated = (0, _index.processSocialOptions)(opts);\n    m = tsetSocial(m, 'socialButtonStyle', curated.socialButtonStyle);\n  }\n\n  if (opts.flashMessage) {\n    var type = opts.flashMessage.type;\n    var typeCapitalized = type.charAt(0).toUpperCase() + type.slice(1);\n    m = tset(m, 'global' + typeCapitalized, opts.flashMessage.text);\n  }\n\n  if (opts.auth && opts.auth.params) {\n    m = tset(m, 'authParams', _immutable2.default.fromJS(opts.auth.params));\n  }\n\n  if (opts.theme) {\n    if (opts.theme.primaryColor) {\n      m = tset(m, ['ui', 'primaryColor'], opts.theme.primaryColor);\n    }\n\n    if (opts.theme.logo) {\n      m = tset(m, ['ui', 'logo'], opts.theme.logo);\n    }\n  }\n\n  if (opts.language || opts.languageDictionary) {\n    if (opts.language) {\n      m = tset(m, ['ui', 'language'], opts.language);\n    }\n\n    if (opts.languageDictionary) {\n      m = tset(m, ['ui', 'dict'], opts.languageDictionary);\n    }\n\n    m = i18n.initI18n(m);\n  }\n\n  if (typeof opts.rememberLastLogin === 'boolean') {\n    m = tset(m, 'rememberLastLogin', opts.rememberLastLogin);\n  }\n\n  if (typeof opts.allowAutocomplete === 'boolean') {\n    m = tset(m, 'allowAutocomplete', opts.allowAutocomplete);\n  }\n\n  if (typeof opts.allowShowPassword === 'boolean') {\n    m = tset(m, 'allowShowPassword', opts.allowShowPassword);\n  }\n\n  if (typeof opts.allowPasswordAutocomplete === 'boolean') {\n    m = tset(m, 'allowPasswordAutocomplete', opts.allowPasswordAutocomplete);\n  }\n\n  return m;\n}","map":null,"metadata":{},"sourceType":"script"}